<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mortgage Payoff Calculator (Version A)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    .mpc-container {
      max-width: 800px;
      margin: 0 auto;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      padding: 1.5rem;
      border-radius: 12px;
      border: 1px solid #ddd;
      background: #fafafa;
    }
    .mpc-container h2 {
      margin-top: 0;
      margin-bottom: 0.5rem;
    }
    .mpc-description {
      font-size: 0.9rem;
      color: #555;
      margin-bottom: 1rem;
    }
    .mpc-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 0.75rem 1rem;
    }
    .mpc-field {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      font-size: 0.9rem;
    }
    .mpc-field label {
      font-weight: 600;
    }
    .mpc-field small {
      font-size: 0.8rem;
      color: #666;
    }
    .mpc-field input {
      padding: 0.45rem 0.55rem;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 0.9rem;
    }
    .mpc-actions {
      margin-top: 1rem;
      display: flex;
      justify-content: flex-start;
      gap: 0.75rem;
    }
    .mpc-button {
      border-radius: 999px;
      border: none;
      padding: 0.55rem 1.25rem;
      font-size: 0.95rem;
      cursor: pointer;
      background: #1e88e5;
      color: #fff;
      font-weight: 600;
    }
    .mpc-button.secondary {
      background: #eee;
      color: #333;
      border: 1px solid #ccc;
    }
    .mpc-results {
      margin-top: 1rem;
      padding: 0.85rem 1rem;
      border-radius: 8px;
      background: #f4f8ff;
      border: 1px solid #c5d9ff;
      font-size: 0.9rem;
    }
    .mpc-results h4 {
      margin-top: 0;
      margin-bottom: 0.35rem;
    }
    .mpc-error {
      color: #b00020;
      font-size: 0.85rem;
      margin-top: 0.25rem;
    }
    .mpc-disclaimer {
      margin-top: 1rem;
      font-size: 0.8rem;
      color: #777;
    }
    @media (max-width: 600px) {
      .mpc-container {
        padding: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="mpc-container">
    <h2>Mortgage Payoff Calculator</h2>
    <p class="mpc-description">
      Start with your original loan details, estimate your remaining balance today, and see how an extra monthly
      principal payment could change your payoff date. This is for <strong>illustrative purposes only</strong> —
      actual figures may differ. Please confirm details with your lender.
    </p>

    <div id="mpc-mode-original">
      <h3 style="margin-top:0;">Start from Original Loan</h3>

      <div class="mpc-grid">
        <div class="mpc-field">
          <label for="mpc-orig-purchase-price">Original Purchase Price ($)</label>
          <input type="number" id="mpc-orig-purchase-price" placeholder="300000" min="0" step="1000" />
          <small>If you know your original loan amount, enter it below.</small>
        </div>

        <div class="mpc-field">
          <label for="mpc-orig-loan-amount">Original Loan Amount ($)</label>
          <input type="number" id="mpc-orig-loan-amount" placeholder="Leave blank to use purchase price" min="0" step="1000" />
          <small>Optional. Use this if you made a down payment.</small>
        </div>

        <div class="mpc-field">
          <label for="mpc-current-balance">Current Balance ($) – optional</label>
          <input type="number" id="mpc-current-balance" placeholder="e.g. 87000" min="0" step="1000" />
          <small>If you know your current balance, enter it for more accurate payoff timing.</small>
        </div>

        <div class="mpc-field">
          <label for="mpc-orig-rate">Interest Rate (APR %)</label>
          <input type="number" id="mpc-orig-rate" placeholder="4.25" step="0.01" />
        </div>

        <div class="mpc-field">
          <label for="mpc-orig-term">Loan Term (years)</label>
          <input type="number" id="mpc-orig-term" value="30" min="1" step="1" />
          <small>Most fixed-rate mortgages are 15 or 30 years.</small>
        </div>

        <div class="mpc-field">
          <label for="mpc-orig-date">Purchase / Loan Start Date</label>
          <input type="date" id="mpc-orig-date" />
        </div>

        <div class="mpc-field">
          <label for="mpc-orig-extra">Extra Monthly Principal ($)</label>
          <input type="number" id="mpc-orig-extra" placeholder="e.g. 150" min="0" step="10" />
          <small>How much extra you'd like to add to principal each month.</small>
        </div>
      </div>

      <div class="mpc-actions">
        <button class="mpc-button" id="mpc-calc-btn">Calculate</button>
        <button class="mpc-button secondary" id="mpc-reset-btn">Reset</button>
      </div>

      <div id="mpc-orig-error" class="mpc-error"></div>
      <div id="mpc-orig-results" class="mpc-results" style="display:none;"></div>
    </div>

    <p class="mpc-disclaimer">
      This calculator estimates principal and interest based on a standard fixed-rate mortgage amortization.
      It does not account for escrow (taxes/insurance), adjustable rates, late payments, or fees.
      Always verify payoff amounts and dates with your loan servicer.
    </p>
  </div>

  <script>
    // ---------- Utility functions ----------
    function mpcFormatCurrency(value, decimals = 2) {
      const num = Number(value);
      if (!isFinite(num)) return '$0';
      return num.toLocaleString(undefined, {
        style: 'currency',
        currency: 'USD',
        minimumFractionDigits: decimals,
        maximumFractionDigits: decimals
      });
    }

    function mpcDiffInMonths(d1, d2) {
      return (d2.getFullYear() - d1.getFullYear()) * 12 + (d2.getMonth() - d1.getMonth());
    }

    function mpcAddMonths(date, months) {
      const d = new Date(date.getTime());
      d.setMonth(d.getMonth() + months);
      return d;
    }

    function mpcFormatDate(date) {
      return date.toLocaleDateString(undefined, {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }

    function mpcMonthlyPayment(P, annualRate, years) {
      const n = years * 12;
      if (n <= 0) return 0;
      if (annualRate === 0) return P / n;

      const r = annualRate / 12;
      const factor = Math.pow(1 + r, n);
      return P * (r * factor) / (factor - 1);
    }

    function mpcBalanceAfter(P, annualRate, years, kPayments) {
      const n = years * 12;
      const k = Math.max(0, Math.min(kPayments, n));

      if (annualRate === 0) {
        const principalPaid = (P / n) * k;
        return Math.max(0, P - principalPaid);
      }
      const r = annualRate / 12;
      const factorN = Math.pow(1 + r, n);
      const factorK = Math.pow(1 + r, k);
      const balance = P * (factorN - factorK) / (factorN - 1);
      retur
